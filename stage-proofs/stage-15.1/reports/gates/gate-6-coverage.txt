
> workflow-root@1.0.0 test:coverage
> turbo run test:coverage

turbo 2.6.1

‚Ä¢ Packages in scope: @workflow/api-client, @workflow/cli, @workflow/graph, @workflow/mcp-server, @workflow/types, @workflow/ui-components, @workflow/validation, workflow-ui, workflow-vscode-client, workflow-vscode-server
‚Ä¢ Running test:coverage in 10 packages
‚Ä¢ Remote caching disabled
@workflow/mcp-server:build: cache miss, executing 680f956153484eaa
@workflow/types:build: cache miss, executing f05ff5688f19ae22
@workflow/cli:build: cache miss, executing 812235addea4f75e
@workflow/api-client:build: cache miss, executing 5d625db2f5bad94c
workflow-ui:build: cache hit, replaying logs bae72945adfa053b
workflow-ui:build: 
workflow-ui:build: > workflow-ui@0.1.0 build /Users/darren/dev/workflow/src/workflow-ui
workflow-ui:build: > next build
workflow-ui:build: 
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build:  ‚ö† Warning: Next.js inferred your workspace root, but it may not be correct.
workflow-ui:build:  We detected multiple lockfiles and selected the directory of /Users/darren/package-lock.json as the root directory.
workflow-ui:build:  To silence this warning, set `turbopack.root` in your Next.js config, or consider removing one of the lockfiles if it's not needed.
workflow-ui:build:    See https://nextjs.org/docs/app/api-reference/config/next-config-js/turbopack#root-directory for more information.
workflow-ui:build:  Detected additional lockfiles: 
workflow-ui:build:    * /Users/darren/dev/workflow/src/workflow-ui/package-lock.json
workflow-ui:build:    * /Users/darren/dev/workflow/pnpm-lock.yaml
workflow-ui:build: 
workflow-ui:build:    ‚ñ≤ Next.js 16.0.3 (Turbopack)
workflow-ui:build:    - Environments: .env.local
workflow-ui:build: 
workflow-ui:build:    Creating an optimized production build ...
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build:  ‚úì Compiled successfully in 17.4s
workflow-ui:build:    Running TypeScript ...
workflow-ui:build:    Collecting page data using 15 workers ...
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build:    Generating static pages using 15 workers (0/19) ...
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build:    Generating static pages using 15 workers (4/19) 
workflow-ui:build:    Generating static pages using 15 workers (9/19) 
workflow-ui:build:    Generating static pages using 15 workers (14/19) 
workflow-ui:build:  ‚úì Generating static pages using 15 workers (19/19) in 1526.3ms
workflow-ui:build:    Finalizing page optimization ...
workflow-ui:build: 
workflow-ui:build: Route (app)
workflow-ui:build: ‚îå ‚óã /
workflow-ui:build: ‚îú ‚óã /_not-found
workflow-ui:build: ‚îú ∆í /api/executions/[id]
workflow-ui:build: ‚îú ∆í /api/executions/[id]/trace
workflow-ui:build: ‚îú ∆í /api/generate-workflow
workflow-ui:build: ‚îú ∆í /api/tasks
workflow-ui:build: ‚îú ∆í /api/tasks/[name]
workflow-ui:build: ‚îú ∆í /api/tasks/[name]/duration-trends
workflow-ui:build: ‚îú ∆í /api/tasks/[name]/execute
workflow-ui:build: ‚îú ∆í /api/tasks/[name]/executions
workflow-ui:build: ‚îú ∆í /api/tasks/[name]/usage
workflow-ui:build: ‚îú ∆í /api/templates
workflow-ui:build: ‚îú ∆í /api/templates/[name]
workflow-ui:build: ‚îú ∆í /api/workflows
workflow-ui:build: ‚îú ∆í /api/workflows/[name]
workflow-ui:build: ‚îú ∆í /api/workflows/[name]/duration-trends
workflow-ui:build: ‚îú ∆í /api/workflows/[name]/execute
workflow-ui:build: ‚îú ∆í /api/workflows/[name]/executions
workflow-ui:build: ‚îú ∆í /api/workflows/[name]/test
workflow-ui:build: ‚îú ∆í /api/workflows/[name]/versions
workflow-ui:build: ‚îú ‚óã /dashboard
workflow-ui:build: ‚îú ∆í /executions/[id]/debug
workflow-ui:build: ‚îú ‚óã /playground
workflow-ui:build: ‚îú ∆í /playground/[lessonId]
workflow-ui:build: ‚îú ‚óã /tasks
workflow-ui:build: ‚îú ∆í /tasks/[name]
workflow-ui:build: ‚îú ‚óã /templates
workflow-ui:build: ‚îú ‚óã /transforms
workflow-ui:build: ‚îú ‚óã /visualization
workflow-ui:build: ‚îú ‚óã /visualization/galaxy
workflow-ui:build: ‚îú ‚óã /visualization/traffic
workflow-ui:build: ‚îú ‚óã /visualization/tube
workflow-ui:build: ‚îú ‚óã /workflows
workflow-ui:build: ‚îú ∆í /workflows/[name]
workflow-ui:build: ‚îî ‚óã /workflows/new
workflow-ui:build: 
workflow-ui:build: 
workflow-ui:build: ‚óã  (Static)   prerendered as static content
workflow-ui:build: ∆í  (Dynamic)  server-rendered on demand
workflow-ui:build: 
workflow-ui:test:coverage: cache miss, executing 5cd2fc4c54e74c26
@workflow/cli:build: 
@workflow/cli:build: > @workflow/cli@0.1.0 build /Users/darren/dev/workflow/packages/workflow-cli
@workflow/cli:build: > tsc
@workflow/cli:build: 
@workflow/api-client:build: 
@workflow/api-client:build: > @workflow/api-client@0.1.0 build /Users/darren/dev/workflow/packages/workflow-api-client
@workflow/api-client:build: > tsc
@workflow/api-client:build: 
@workflow/mcp-server:build: 
@workflow/mcp-server:build: > @workflow/mcp-server@0.1.0 build /Users/darren/dev/workflow/packages/workflow-mcp-server
@workflow/mcp-server:build: > tsc
@workflow/mcp-server:build: 
@workflow/types:build: 
@workflow/types:build: > @workflow/types@0.1.0 build /Users/darren/dev/workflow/packages/workflow-types
@workflow/types:build: > tsc
@workflow/types:build: 
workflow-ui:test:coverage: 
workflow-ui:test:coverage: > workflow-ui@0.1.0 test:coverage /Users/darren/dev/workflow/src/workflow-ui
workflow-ui:test:coverage: > vitest run --coverage
workflow-ui:test:coverage: 
@workflow/validation:build: cache miss, executing f353b29ff9219c24
workflow-ui:test:coverage: 
workflow-ui:test:coverage: [1m[46m RUN [49m[22m [36mv4.0.14 [39m[90m/Users/darren/dev/workflow/src/workflow-ui[39m
workflow-ui:test:coverage:       [2mCoverage enabled with [22m[33mv8[39m
workflow-ui:test:coverage: 
@workflow/validation:build: 
@workflow/validation:build: > @workflow/validation@0.1.0 build /Users/darren/dev/workflow/packages/workflow-validation
@workflow/validation:build: > tsc
@workflow/validation:build: 
@workflow/cli:test:coverage: cache miss, executing 4f781ab9c4ed8d32
@workflow/mcp-server:test:coverage: cache miss, executing 247d44c764a4e786
@workflow/cli:test:coverage: 
@workflow/cli:test:coverage: > @workflow/cli@0.1.0 test:coverage /Users/darren/dev/workflow/packages/workflow-cli
@workflow/cli:test:coverage: > vitest run --coverage
@workflow/cli:test:coverage: 
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: > @workflow/mcp-server@0.1.0 test:coverage /Users/darren/dev/workflow/packages/workflow-mcp-server
@workflow/mcp-server:test:coverage: > vitest run --coverage
@workflow/mcp-server:test:coverage: 
@workflow/graph:build: cache miss, executing 75de8c020acffc08
@workflow/cli:test:coverage: 
@workflow/cli:test:coverage:  RUN  v2.1.9 /Users/darren/dev/workflow/packages/workflow-cli
@workflow/cli:test:coverage:       Coverage enabled with v8
@workflow/cli:test:coverage: 
@workflow/graph:build: 
@workflow/graph:build: > @workflow/graph@0.1.0 build /Users/darren/dev/workflow/packages/workflow-graph
@workflow/graph:build: > tsc
@workflow/graph:build: 
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  RUN  v2.1.9 /Users/darren/dev/workflow/packages/workflow-mcp-server
@workflow/mcp-server:test:coverage:       Coverage enabled with v8
@workflow/mcp-server:test:coverage: 
@workflow/cli:test:coverage:  ‚úì tests/generators/output-schema-generator.test.ts (8 tests) 44ms
@workflow/cli:test:coverage:  ‚úì tests/services/debugger.test.ts (21 tests) 143ms
@workflow/cli:test:coverage:  ‚úì tests/services/mock-executor.test.ts (15 tests) 236ms
@workflow/cli:test:coverage:  ‚úì tests/openapi-parser.test.ts (20 tests) 109ms
@workflow/cli:test:coverage:  ‚úì tests/commands/init.test.ts (18 tests) 169ms
@workflow/cli:test:coverage:  ‚úì tests/services/gateway-client.test.ts (23 tests) 112ms
@workflow/cli:test:coverage:  ‚úì tests/commands/test.test.ts (16 tests) 40ms
@workflow/cli:test:coverage:  ‚úì tests/commands/validate.test.ts (17 tests) 181ms
@workflow/cli:test:coverage:  ‚úì tests/commands/run.test.ts (14 tests) 76ms
@workflow/cli:test:coverage:  ‚úì tests/commands/tasks.test.ts (20 tests) 191ms
@workflow/cli:test:coverage:  ‚úì tests/commands/explain.test.ts (20 tests) 213ms
@workflow/cli:test:coverage:  ‚úì tests/commands/debug.test.ts (21 tests) 46ms
@workflow/cli:test:coverage:  ‚úì tests/config.test.ts (21 tests) 266ms
@workflow/cli:test:coverage:  ‚úì tests/loaders.test.ts (18 tests) 258ms
@workflow/cli:test:coverage:  ‚úì tests/crd-generator.test.ts (24 tests) 473ms
@workflow/mcp-server:test:coverage:  ‚úì tests/tools/dry-run-workflow.test.ts (7 tests) 28ms
@workflow/mcp-server:test:coverage:  ‚úì tests/prompts/error-fixing.test.ts (24 tests) 28ms
@workflow/mcp-server:test:coverage:  ‚úì tests/tools/validate-workflow.test.ts (10 tests) 36ms
@workflow/mcp-server:test:coverage:  ‚úì tests/prompts/few-shot-examples.test.ts (10 tests) 42ms
@workflow/mcp-server:test:coverage:  ‚úì tests/prompts/system-prompt.test.ts (7 tests) 46ms
@workflow/mcp-server:test:coverage:  ‚úì tests/tools/execute-workflow.test.ts (8 tests) 57ms
@workflow/mcp-server:test:coverage:  ‚úì tests/tools/list-tasks.test.ts (10 tests) 33ms
@workflow/mcp-server:test:coverage:  ‚ùØ tests/services/refinement-service.test.ts (15 tests | 4 failed) 433ms
@workflow/mcp-server:test:coverage:    √ó RefinementService > termination: max_iterations > should stop after max iterations 74ms
@workflow/mcp-server:test:coverage:      ‚Üí expected 'oscillation_detected' to be 'max_iterations' // Object.is equality
@workflow/mcp-server:test:coverage:    √ó RefinementService > termination: max_iterations > should respect custom max iterations 18ms
@workflow/mcp-server:test:coverage:      ‚Üí expected 'no_progress' to be 'max_iterations' // Object.is equality
@workflow/mcp-server:test:coverage:    √ó RefinementService > termination: oscillation_detected > should detect oscillation when same errors reappear 17ms
@workflow/mcp-server:test:coverage:      ‚Üí expected 'no_progress' to be 'oscillation_detected' // Object.is equality
@workflow/mcp-server:test:coverage:    √ó RefinementService > history tracking > should track each iteration in history 168ms
@workflow/mcp-server:test:coverage:      ‚Üí expected [ { iteration: 1, ‚Ä¶(2) } ] to have a length of 2 but got 1
@workflow/mcp-server:test:coverage:  ‚úì tests/services/llm-service.test.ts (9 tests) 376ms
@workflow/mcp-server:test:coverage:  ‚ùØ tests/services/gateway-client.test.ts (18 tests | 3 failed) 336ms
@workflow/mcp-server:test:coverage:    √ó GatewayClient > validateWorkflow > should validate a workflow successfully 59ms
@workflow/mcp-server:test:coverage:      ‚Üí expected "spy" to be called with arguments: [ ‚Ä¶(2) ]
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: Received: 
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:   1st spy call:
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:   Array [
@workflow/mcp-server:test:coverage:     "http://localhost:5000/api/v1/workflows/test-execute",
@workflow/mcp-server:test:coverage:     Object {
@workflow/mcp-server:test:coverage: -     "body": "name: test-workflow
@workflow/mcp-server:test:coverage: - tasks: []",
@workflow/mcp-server:test:coverage: +     "body": "{\"workflowYaml\":\"name: test-workflow\\ntasks: []\",\"input\":{}}",
@workflow/mcp-server:test:coverage:       "headers": Object {
@workflow/mcp-server:test:coverage: -       "Content-Type": "application/x-yaml",
@workflow/mcp-server:test:coverage: +       "Content-Type": "application/json",
@workflow/mcp-server:test:coverage:       },
@workflow/mcp-server:test:coverage:       "method": "POST",
@workflow/mcp-server:test:coverage:     },
@workflow/mcp-server:test:coverage:   ]
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: Number of calls: 1
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:    √ó GatewayClient > validateWorkflow > should handle validation errors from API 11ms
@workflow/mcp-server:test:coverage:      ‚Üí expected true to be false // Object.is equality
@workflow/mcp-server:test:coverage:    √ó GatewayClient > validateWorkflow > should handle API errors during validation 83ms
@workflow/mcp-server:test:coverage:      ‚Üí expected [Function] to throw error including 'Failed to validate workflow: 400 Bad ‚Ä¶' but got 'response.json is not a function'
@workflow/mcp-server:test:coverage: stderr | tests/tools/generate-workflow.test.ts > generateWorkflow tool > generateWorkflow > should fall back to template when LLM fails
@workflow/mcp-server:test:coverage: LLM generation failed, falling back to template: Error: API error
@workflow/mcp-server:test:coverage:     at t.<anonymous> (/Users/darren/dev/workflow/packages/workflow-mcp-server/tests/tools/generate-workflow.test.ts:323:55)
@workflow/mcp-server:test:coverage:     at new mockCall (file:///Users/darren/dev/workflow/node_modules/.pnpm/@vitest+spy@2.1.9/node_modules/@vitest/spy/dist/index.js:61:17)
@workflow/mcp-server:test:coverage:     at new spy (file:///Users/darren/dev/workflow/node_modules/.pnpm/tinyspy@3.0.2/node_modules/tinyspy/dist/index.js:45:34)
@workflow/mcp-server:test:coverage:     at new LlmService (/Users/darren/dev/workflow/packages/workflow-mcp-server/src/services/llm-service.ts:21:21)
@workflow/mcp-server:test:coverage:     at getLlmService (/Users/darren/dev/workflow/packages/workflow-mcp-server/src/tools/generate-workflow.ts:217:18)
@workflow/mcp-server:test:coverage:     at generateWorkflow (/Users/darren/dev/workflow/packages/workflow-mcp-server/src/tools/generate-workflow.ts:256:19)
@workflow/mcp-server:test:coverage:     at processTicksAndRejections (node:internal/process/task_queues:105:5)
@workflow/mcp-server:test:coverage:     at /Users/darren/dev/workflow/packages/workflow-mcp-server/tests/tools/generate-workflow.test.ts:334:22
@workflow/mcp-server:test:coverage:     at file:///Users/darren/dev/workflow/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:5
@workflow/mcp-server:test:coverage:     at runTest (file:///Users/darren/dev/workflow/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:11)
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  ‚úì tests/tools/generate-workflow.test.ts (22 tests) 1322ms
@workflow/mcp-server:test:coverage:    ‚úì generateWorkflow tool > generateWorkflow > should use LLM when available and useLLM is not false 709ms
@workflow/mcp-server:test:coverage:    ‚úì generateWorkflow tool > generateWorkflow > should fall back to template when LLM fails 541ms
@workflow/cli:test:coverage:  ‚úì tests/generators/permission-label-generator.test.ts (7 tests) 41ms
@workflow/cli:test:coverage:  ‚úì tests/generators/http-config-generator.test.ts (9 tests) 47ms
@workflow/cli:test:coverage:  ‚úì tests/generators/input-schema-generator.test.ts (8 tests) 64ms
@workflow/cli:test:coverage:  ‚úì tests/generators/task-name-generator.test.ts (9 tests) 35ms
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ Failed Tests 7 ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  FAIL  tests/services/gateway-client.test.ts > GatewayClient > validateWorkflow > should validate a workflow successfully
@workflow/mcp-server:test:coverage: AssertionError: expected "spy" to be called with arguments: [ ‚Ä¶(2) ]
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: Received: 
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:   1st spy call:
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:   Array [
@workflow/mcp-server:test:coverage:     "http://localhost:5000/api/v1/workflows/test-execute",
@workflow/mcp-server:test:coverage:     Object {
@workflow/mcp-server:test:coverage: -     "body": "name: test-workflow
@workflow/mcp-server:test:coverage: - tasks: []",
@workflow/mcp-server:test:coverage: +     "body": "{\"workflowYaml\":\"name: test-workflow\\ntasks: []\",\"input\":{}}",
@workflow/mcp-server:test:coverage:       "headers": Object {
@workflow/mcp-server:test:coverage: -       "Content-Type": "application/x-yaml",
@workflow/mcp-server:test:coverage: +       "Content-Type": "application/json",
@workflow/mcp-server:test:coverage:       },
@workflow/mcp-server:test:coverage:       "method": "POST",
@workflow/mcp-server:test:coverage:     },
@workflow/mcp-server:test:coverage:   ]
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: Number of calls: 1
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  ‚ùØ tests/services/gateway-client.test.ts:118:25
workflow-vscode-server:build: cache miss, executing 10f2cec8c9e8bc8f
workflow-vscode-client:build: cache miss, executing 26751eb2ad162195
@workflow/ui-components:build: cache miss, executing c475988baada1373
@workflow/cli:test:coverage:  ‚úì tests/generators/task-yaml-writer.test.ts (5 tests) 173ms
@workflow/mcp-server:test:coverage:     116|       const result = await client.validateWorkflow(yaml);
@workflow/mcp-server:test:coverage:     117| 
@workflow/mcp-server:test:coverage:     118|       expect(mockFetch).toHaveBeenCalledWith('http://localhost:5000/ap‚Ä¶
@workflow/mcp-server:test:coverage:        |                         ^
@workflow/mcp-server:test:coverage:     119|         method: 'POST',
@workflow/mcp-server:test:coverage:     120|         headers: { 'Content-Type': 'application/x-yaml' },
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/7]‚éØ
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  FAIL  tests/services/gateway-client.test.ts > GatewayClient > validateWorkflow > should handle validation errors from API
@workflow/mcp-server:test:coverage: AssertionError: expected true to be false // Object.is equality
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: - Expected
@workflow/mcp-server:test:coverage: + Received
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: - false
@workflow/mcp-server:test:coverage: + true
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  ‚ùØ tests/services/gateway-client.test.ts:142:28
@workflow/mcp-server:test:coverage:     140|       const result = await client.validateWorkflow(yaml);
@workflow/mcp-server:test:coverage:     141| 
@workflow/mcp-server:test:coverage:     142|       expect(result.valid).toBe(false);
@workflow/mcp-server:test:coverage:        |                            ^
@workflow/mcp-server:test:coverage:     143|       expect(result.errors).toHaveLength(1);
@workflow/mcp-server:test:coverage:     144|     });
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/7]‚éØ
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  FAIL  tests/services/gateway-client.test.ts > GatewayClient > validateWorkflow > should handle API errors during validation
@workflow/mcp-server:test:coverage: AssertionError: expected [Function] to throw error including 'Failed to validate workflow: 400 Bad ‚Ä¶' but got 'response.json is not a function'
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: Expected: "Failed to validate workflow: 400 Bad Request"
@workflow/mcp-server:test:coverage: Received: "response.json is not a function"
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  ‚ùØ tests/services/gateway-client.test.ts:153:7
@workflow/mcp-server:test:coverage:     151|       });
@workflow/mcp-server:test:coverage:     152| 
@workflow/mcp-server:test:coverage:     153|       await expect(client.validateWorkflow('invalid yaml')).rejects.to‚Ä¶
@workflow/mcp-server:test:coverage:        |       ^
@workflow/mcp-server:test:coverage:     154|     });
@workflow/mcp-server:test:coverage:     155|   });
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/7]‚éØ
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  FAIL  tests/services/refinement-service.test.ts > RefinementService > termination: max_iterations > should stop after max iterations
@workflow/mcp-server:test:coverage: AssertionError: expected 'oscillation_detected' to be 'max_iterations' // Object.is equality
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: Expected: "max_iterations"
@workflow/mcp-server:test:coverage: Received: "oscillation_detected"
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  ‚ùØ tests/services/refinement-service.test.ts:87:40
@workflow/mcp-server:test:coverage:      85| 
@workflow/mcp-server:test:coverage:      86|       expect(result.valid).toBe(false);
@workflow/mcp-server:test:coverage:      87|       expect(result.terminationReason).toBe('max_iterations');
@workflow/mcp-server:test:coverage:        |                                        ^
@workflow/mcp-server:test:coverage:      88|       expect(result.history.length).toBeLessThanOrEqual(2);
@workflow/mcp-server:test:coverage:      89|     });
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/7]‚éØ
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  FAIL  tests/services/refinement-service.test.ts > RefinementService > termination: max_iterations > should respect custom max iterations
@workflow/mcp-server:test:coverage: AssertionError: expected 'no_progress' to be 'max_iterations' // Object.is equality
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: Expected: "max_iterations"
@workflow/mcp-server:test:coverage: Received: "no_progress"
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  ‚ùØ tests/services/refinement-service.test.ts:105:40
@workflow/mcp-server:test:coverage:     103|       const result = await service.refineWorkflow('name: test', mockTa‚Ä¶
@workflow/mcp-server:test:coverage:     104| 
@workflow/mcp-server:test:coverage:     105|       expect(result.terminationReason).toBe('max_iterations');
@workflow/mcp-server:test:coverage:        |                                        ^
@workflow/mcp-server:test:coverage:     106|       expect(callCount).toBe(5);
@workflow/mcp-server:test:coverage:     107|     });
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/7]‚éØ
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  FAIL  tests/services/refinement-service.test.ts > RefinementService > termination: oscillation_detected > should detect oscillation when same errors reappear
@workflow/mcp-server:test:coverage: AssertionError: expected 'no_progress' to be 'oscillation_detected' // Object.is equality
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: Expected: "oscillation_detected"
@workflow/mcp-server:test:coverage: Received: "no_progress"
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  ‚ùØ tests/services/refinement-service.test.ts:133:40
@workflow/mcp-server:test:coverage:     131| 
@workflow/mcp-server:test:coverage:     132|       expect(result.valid).toBe(false);
@workflow/mcp-server:test:coverage:     133|       expect(result.terminationReason).toBe('oscillation_detected');
@workflow/mcp-server:test:coverage:        |                                        ^
@workflow/mcp-server:test:coverage:     134|     });
@workflow/mcp-server:test:coverage:     135| 
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/7]‚éØ
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  FAIL  tests/services/refinement-service.test.ts > RefinementService > history tracking > should track each iteration in history
@workflow/mcp-server:test:coverage: AssertionError: expected [ { iteration: 1, ‚Ä¶(2) } ] to have a length of 2 but got 1
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: - Expected
@workflow/mcp-server:test:coverage: + Received
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: - 2
@workflow/mcp-server:test:coverage: + 1
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  ‚ùØ tests/services/refinement-service.test.ts:323:30
@workflow/mcp-server:test:coverage:     321|       const result = await service.refineWorkflow('name: test', mockTa‚Ä¶
@workflow/mcp-server:test:coverage:     322| 
@workflow/mcp-server:test:coverage:     323|       expect(result.history).toHaveLength(2);
@workflow/mcp-server:test:coverage:        |                              ^
@workflow/mcp-server:test:coverage:     324|       expect(result.history[0].iteration).toBe(1);
@workflow/mcp-server:test:coverage:     325|       expect(result.history[1].iteration).toBe(2);
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/7]‚éØ
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  Test Files  2 failed | 9 passed (11)
@workflow/mcp-server:test:coverage:       Tests  7 failed | 133 passed (140)
@workflow/mcp-server:test:coverage:    Start at  21:28:51
@workflow/mcp-server:test:coverage:    Duration  11.48s (transform 13.69s, setup 0ms, collect 20.14s, tests 2.74s, environment 16ms, prepare 11.84s)
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: ‚ÄâELIFECYCLE‚Äâ Command failed with exit code 1.
@workflow/cli:test:coverage: 
@workflow/cli:test:coverage:  Test Files  20 passed (20)
@workflow/cli:test:coverage:       Tests  314 passed (314)
@workflow/cli:test:coverage:    Start at  21:28:48
@workflow/cli:test:coverage:    Duration  16.77s (transform 42.04s, setup 0ms, collect 78.27s, tests 2.92s, environment 166ms, prepare 38.75s)
@workflow/cli:test:coverage: 
@workflow/cli:test:coverage:  % Coverage report from v8
@workflow/cli:test:coverage: -------------------|---------|----------|---------|---------|-------------------
@workflow/cli:test:coverage: File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
@workflow/cli:test:coverage: -------------------|---------|----------|---------|---------|-------------------
@workflow/cli:test:coverage: All files          |   91.91 |    82.57 |   98.64 |   91.91 |                   
@workflow/cli:test:coverage:  src               |   82.72 |     80.3 |    92.3 |   82.72 |                   
@workflow/cli:test:coverage:   config.ts        |   98.82 |    95.65 |     100 |   98.82 | 119               
@workflow/cli:test:coverage:   crd-generator.ts |     100 |      100 |     100 |     100 |                   
@workflow/cli:test:coverage:   loaders.ts       |   92.45 |    91.66 |     100 |   92.45 | 128-129,157-158   
@workflow/cli:test:coverage:   ...api-parser.ts |   71.53 |    67.14 |    87.5 |   71.53 | ...84-387,400-415 
@workflow/cli:test:coverage:  src/commands      |   94.56 |    83.78 |     100 |   94.56 |                   
@workflow/cli:test:coverage:   debug.ts         |   84.06 |       65 |     100 |   84.06 | ...79-280,318-319 
@workflow/cli:test:coverage:   explain.ts       |   98.52 |    81.25 |     100 |   98.52 | 67,119-120        
@workflow/cli:test:coverage:   init.ts          |   96.51 |    89.47 |     100 |   96.51 | 94-127            
@workflow/cli:test:coverage:   run.ts           |   91.08 |    68.42 |     100 |   91.08 | 116-123,137       
@workflow/cli:test:coverage:   tasks.ts         |     100 |     92.3 |     100 |     100 | 113,152           
@workflow/cli:test:coverage:   test.ts          |   95.75 |    88.52 |     100 |   95.75 | 126-133,147       
@workflow/cli:test:coverage:   validate.ts      |   96.79 |    89.42 |     100 |   96.79 | ...,93-94,206-207 
@workflow/cli:test:coverage:  src/generators    |   96.24 |       90 |     100 |   96.24 |                   
@workflow/cli:test:coverage:   ...-generator.ts |     100 |       90 |     100 |     100 | 48                
@workflow/cli:test:coverage:   index.ts         |     100 |      100 |     100 |     100 |                   
@workflow/cli:test:coverage:   ...-generator.ts |     100 |      100 |     100 |     100 |                   
@workflow/cli:test:coverage:   ...-generator.ts |     100 |      100 |     100 |     100 |                   
@workflow/cli:test:coverage:   ...-generator.ts |   90.16 |    79.31 |     100 |   90.16 | ...05-106,108-109 
@workflow/cli:test:coverage:   ...-generator.ts |    92.3 |    83.33 |     100 |    92.3 | 60-61             
@workflow/cli:test:coverage:   ...aml-writer.ts |     100 |      100 |     100 |     100 |                   
@workflow/cli:test:coverage:  src/services      |   93.01 |    78.26 |     100 |   93.01 |                   
@workflow/cli:test:coverage:   debugger.ts      |   88.93 |    71.42 |     100 |   88.93 | ...03,413,427-430 
@workflow/cli:test:coverage:   ...way-client.ts |     100 |    93.75 |     100 |     100 | 219,234           
@workflow/cli:test:coverage:   mock-executor.ts |   93.54 |    77.27 |     100 |   93.54 | ...69,279,298-301 
@workflow/cli:test:coverage: -------------------|---------|----------|---------|---------|-------------------
@workflow/mcp-server:test:coverage: ERROR: command finished with error: command (/Users/darren/dev/workflow/packages/workflow-mcp-server) /usr/local/bin/pnpm run test:coverage exited (1)
workflow-ui:test:coverage: ‚ÄâELIFECYCLE‚Äâ Command failed with exit code 130.
@workflow/cli:test:coverage: ‚ÄâELIFECYCLE‚Äâ Command failed.
@workflow/mcp-server#test:coverage: command (/Users/darren/dev/workflow/packages/workflow-mcp-server) /usr/local/bin/pnpm run test:coverage exited (1)

 Tasks:    7 successful, 13 total
Cached:    1 cached, 13 total
  Time:    31.321s 
Failed:    @workflow/mcp-server#test:coverage

 ERROR  run failed: command  exited (1)
