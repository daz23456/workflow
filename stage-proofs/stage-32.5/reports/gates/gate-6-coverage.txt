
> workflow-root@1.0.0 test:coverage
> turbo run test:coverage

turbo 2.6.1

â€¢ Packages in scope: @workflow/api-client, @workflow/cli, @workflow/graph, @workflow/mcp-consumer, @workflow/mcp-server, @workflow/types, @workflow/ui-components, @workflow/validation, workflow-ui, workflow-vscode-client, workflow-vscode-server
â€¢ Running test:coverage in 11 packages
â€¢ Remote caching disabled
@workflow/api-client:build: cache miss, executing 5d625db2f5bad94c
@workflow/mcp-server:build: cache miss, executing 680f956153484eaa
@workflow/mcp-consumer:build: cache miss, executing 42065ad24ac8de19
@workflow/cli:build: cache miss, executing ed8c5fa21a3b46fc
@workflow/types:build: cache miss, executing f05ff5688f19ae22
workflow-ui:build: cache hit, replaying logs 2aa87bd62371f215
workflow-ui:build: 
workflow-ui:build: > workflow-ui@0.1.0 build /Users/darren/dev/workflow/src/workflow-ui
workflow-ui:build: > next build
workflow-ui:build: 
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build:  âš  Warning: Next.js inferred your workspace root, but it may not be correct.
workflow-ui:build:  We detected multiple lockfiles and selected the directory of /Users/darren/package-lock.json as the root directory.
workflow-ui:build:  To silence this warning, set `turbopack.root` in your Next.js config, or consider removing one of the lockfiles if it's not needed.
workflow-ui:build:    See https://nextjs.org/docs/app/api-reference/config/next-config-js/turbopack#root-directory for more information.
workflow-ui:build:  Detected additional lockfiles: 
workflow-ui:build:    * /Users/darren/dev/workflow/src/workflow-ui/package-lock.json
workflow-ui:build:    * /Users/darren/dev/workflow/pnpm-lock.yaml
workflow-ui:build: 
workflow-ui:build:    â–² Next.js 16.0.3 (Turbopack)
workflow-ui:build:    - Environments: .env.local
workflow-ui:build: 
workflow-ui:build:    Creating an optimized production build ...
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build:  âœ“ Compiled successfully in 35.2s
workflow-ui:build:    Running TypeScript ...
workflow-ui:build:    Collecting page data using 15 workers ...
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build:    Generating static pages using 15 workers (0/19) ...
workflow-ui:build: [baseline-browser-mapping] The data in this module is over two months old.  To ensure accurate Baseline data, please update: `npm i baseline-browser-mapping@latest -D`
workflow-ui:build:    Generating static pages using 15 workers (4/19) 
workflow-ui:build:    Generating static pages using 15 workers (9/19) 
workflow-ui:build:    Generating static pages using 15 workers (14/19) 
workflow-ui:build:  âœ“ Generating static pages using 15 workers (19/19) in 1828.9ms
workflow-ui:build:    Finalizing page optimization ...
workflow-ui:build: 
workflow-ui:build: Route (app)
workflow-ui:build: â”Œ â—‹ /
workflow-ui:build: â”œ â—‹ /_not-found
workflow-ui:build: â”œ Æ’ /api/executions/[id]
workflow-ui:build: â”œ Æ’ /api/executions/[id]/trace
workflow-ui:build: â”œ Æ’ /api/generate-workflow
workflow-ui:build: â”œ Æ’ /api/tasks
workflow-ui:build: â”œ Æ’ /api/tasks/[name]
workflow-ui:build: â”œ Æ’ /api/tasks/[name]/duration-trends
workflow-ui:build: â”œ Æ’ /api/tasks/[name]/execute
workflow-ui:build: â”œ Æ’ /api/tasks/[name]/executions
workflow-ui:build: â”œ Æ’ /api/tasks/[name]/usage
workflow-ui:build: â”œ Æ’ /api/templates
workflow-ui:build: â”œ Æ’ /api/templates/[name]
workflow-ui:build: â”œ Æ’ /api/workflows
workflow-ui:build: â”œ Æ’ /api/workflows/[name]
workflow-ui:build: â”œ Æ’ /api/workflows/[name]/duration-trends
workflow-ui:build: â”œ Æ’ /api/workflows/[name]/execute
workflow-ui:build: â”œ Æ’ /api/workflows/[name]/executions
workflow-ui:build: â”œ Æ’ /api/workflows/[name]/test
workflow-ui:build: â”œ Æ’ /api/workflows/[name]/versions
workflow-ui:build: â”œ â—‹ /dashboard
workflow-ui:build: â”œ Æ’ /executions/[id]/debug
workflow-ui:build: â”œ â—‹ /playground
workflow-ui:build: â”œ Æ’ /playground/[lessonId]
workflow-ui:build: â”œ â—‹ /tasks
workflow-ui:build: â”œ Æ’ /tasks/[name]
workflow-ui:build: â”œ â—‹ /templates
workflow-ui:build: â”œ â—‹ /transforms
workflow-ui:build: â”œ â—‹ /visualization
workflow-ui:build: â”œ â—‹ /visualization/galaxy
workflow-ui:build: â”œ â—‹ /visualization/traffic
workflow-ui:build: â”œ â—‹ /visualization/tube
workflow-ui:build: â”œ â—‹ /workflows
workflow-ui:build: â”œ Æ’ /workflows/[name]
workflow-ui:build: â”” â—‹ /workflows/new
workflow-ui:build: 
workflow-ui:build: 
workflow-ui:build: â—‹  (Static)   prerendered as static content
workflow-ui:build: Æ’  (Dynamic)  server-rendered on demand
workflow-ui:build: 
workflow-ui:test:coverage: cache miss, executing 86705a96e57bf518
@workflow/types:build: 
@workflow/types:build: > @workflow/types@0.1.0 build /Users/darren/dev/workflow/packages/workflow-types
@workflow/types:build: > tsc
@workflow/types:build: 
@workflow/cli:build: 
@workflow/cli:build: > @workflow/cli@0.1.0 build /Users/darren/dev/workflow/packages/workflow-cli
@workflow/cli:build: > tsc
@workflow/cli:build: 
@workflow/api-client:build: 
@workflow/api-client:build: > @workflow/api-client@0.1.0 build /Users/darren/dev/workflow/packages/workflow-api-client
@workflow/api-client:build: > tsc
@workflow/api-client:build: 
@workflow/mcp-server:build: 
@workflow/mcp-server:build: > @workflow/mcp-server@0.1.0 build /Users/darren/dev/workflow/packages/workflow-mcp-server
@workflow/mcp-server:build: > tsc
@workflow/mcp-server:build: 
@workflow/mcp-consumer:build: 
@workflow/mcp-consumer:build: > @workflow/mcp-consumer@0.1.0 build /Users/darren/dev/workflow/packages/workflow-mcp-consumer
@workflow/mcp-consumer:build: > tsc
@workflow/mcp-consumer:build: 
workflow-ui:test:coverage: 
workflow-ui:test:coverage: > workflow-ui@0.1.0 test:coverage /Users/darren/dev/workflow/src/workflow-ui
workflow-ui:test:coverage: > vitest run --coverage
workflow-ui:test:coverage: 
@workflow/validation:build: cache miss, executing f353b29ff9219c24
workflow-ui:test:coverage: 
workflow-ui:test:coverage: [1m[46m RUN [49m[22m [36mv4.0.14 [39m[90m/Users/darren/dev/workflow/src/workflow-ui[39m
workflow-ui:test:coverage:       [2mCoverage enabled with [22m[33mv8[39m
workflow-ui:test:coverage: 
@workflow/validation:build: 
@workflow/validation:build: > @workflow/validation@0.1.0 build /Users/darren/dev/workflow/packages/workflow-validation
@workflow/validation:build: > tsc
@workflow/validation:build: 
@workflow/cli:test:coverage: cache miss, executing 412a50617de632b9
@workflow/mcp-server:test:coverage: cache miss, executing 247d44c764a4e786
@workflow/mcp-consumer:test:coverage: cache miss, executing 341cc204247750a2
@workflow/cli:test:coverage: 
@workflow/cli:test:coverage: > @workflow/cli@0.1.0 test:coverage /Users/darren/dev/workflow/packages/workflow-cli
@workflow/cli:test:coverage: > vitest run --coverage
@workflow/cli:test:coverage: 
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: > @workflow/mcp-server@0.1.0 test:coverage /Users/darren/dev/workflow/packages/workflow-mcp-server
@workflow/mcp-server:test:coverage: > vitest run --coverage
@workflow/mcp-server:test:coverage: 
@workflow/graph:build: cache miss, executing 75de8c020acffc08
@workflow/mcp-consumer:test:coverage: 
@workflow/mcp-consumer:test:coverage: > @workflow/mcp-consumer@0.1.0 test:coverage /Users/darren/dev/workflow/packages/workflow-mcp-consumer
@workflow/mcp-consumer:test:coverage: > vitest run --coverage
@workflow/mcp-consumer:test:coverage: 
@workflow/graph:build: 
@workflow/graph:build: > @workflow/graph@0.1.0 build /Users/darren/dev/workflow/packages/workflow-graph
@workflow/graph:build: > tsc
@workflow/graph:build: 
@workflow/cli:test:coverage: 
@workflow/cli:test:coverage:  RUN  v2.1.9 /Users/darren/dev/workflow/packages/workflow-cli
@workflow/cli:test:coverage:       Coverage enabled with v8
@workflow/cli:test:coverage: 
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  RUN  v2.1.9 /Users/darren/dev/workflow/packages/workflow-mcp-server
@workflow/mcp-server:test:coverage:       Coverage enabled with v8
@workflow/mcp-server:test:coverage: 
@workflow/mcp-consumer:test:coverage: 
@workflow/mcp-consumer:test:coverage:  RUN  v2.1.9 /Users/darren/dev/workflow/packages/workflow-mcp-consumer
@workflow/mcp-consumer:test:coverage:       Coverage enabled with v8
@workflow/mcp-consumer:test:coverage: 
@workflow/mcp-server:test:coverage:  âœ“ tests/prompts/error-fixing.test.ts (24 tests) 25ms
@workflow/mcp-server:test:coverage:  âœ“ tests/prompts/system-prompt.test.ts (7 tests) 11ms
@workflow/mcp-server:test:coverage:  âœ“ tests/prompts/few-shot-examples.test.ts (10 tests) 14ms
@workflow/mcp-server:test:coverage:  âœ“ tests/tools/dry-run-workflow.test.ts (7 tests) 23ms
@workflow/mcp-server:test:coverage:  âœ“ tests/tools/execute-workflow.test.ts (8 tests) 24ms
@workflow/mcp-server:test:coverage:  âœ“ tests/tools/validate-workflow.test.ts (10 tests) 24ms
@workflow/mcp-server:test:coverage:  âœ“ tests/tools/list-tasks.test.ts (10 tests) 18ms
workflow-ui:test:coverage: [90mstderr[2m | components/transforms/pipeline-builder.test.tsx[2m > [22m[2mPipelineBuilder[2m > [22m[2mRendering[2m > [22m[2mshould render empty canvas
workflow-ui:test:coverage: [22m[39mReact does not recognize the `fitView` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `fitview` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
workflow-ui:test:coverage: React does not recognize the `minZoom` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `minzoom` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
workflow-ui:test:coverage: React does not recognize the `maxZoom` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `maxzoom` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
workflow-ui:test:coverage: React does not recognize the `panOnDrag` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `panondrag` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
workflow-ui:test:coverage: React does not recognize the `zoomOnScroll` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `zoomonscroll` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
workflow-ui:test:coverage: React does not recognize the `preventScrolling` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `preventscrolling` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
workflow-ui:test:coverage: React does not recognize the `defaultEdgeOptions` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `defaultedgeoptions` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
workflow-ui:test:coverage: React does not recognize the `proOptions` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `prooptions` instead. If you accidentally passed it from a parent component, remove it from the DOM element.
workflow-ui:test:coverage: 
@workflow/mcp-server:test:coverage:  âœ“ tests/services/llm-service.test.ts (9 tests) 49ms
@workflow/mcp-server:test:coverage:  â¯ tests/services/refinement-service.test.ts (15 tests | 4 failed) 113ms
@workflow/mcp-server:test:coverage:    Ã— RefinementService > termination: max_iterations > should stop after max iterations 24ms
@workflow/mcp-server:test:coverage:      â†’ expected 'oscillation_detected' to be 'max_iterations' // Object.is equality
@workflow/mcp-server:test:coverage:    Ã— RefinementService > termination: max_iterations > should respect custom max iterations 4ms
@workflow/mcp-server:test:coverage:      â†’ expected 'no_progress' to be 'max_iterations' // Object.is equality
@workflow/mcp-server:test:coverage:    Ã— RefinementService > termination: oscillation_detected > should detect oscillation when same errors reappear 7ms
@workflow/mcp-server:test:coverage:      â†’ expected 'no_progress' to be 'oscillation_detected' // Object.is equality
@workflow/mcp-server:test:coverage:    Ã— RefinementService > history tracking > should track each iteration in history 15ms
@workflow/mcp-server:test:coverage:      â†’ expected [ { iteration: 1, â€¦(2) } ] to have a length of 2 but got 1
@workflow/mcp-server:test:coverage:  â¯ tests/services/gateway-client.test.ts (18 tests | 3 failed) 302ms
@workflow/mcp-server:test:coverage:    Ã— GatewayClient > validateWorkflow > should validate a workflow successfully 75ms
@workflow/mcp-server:test:coverage:      â†’ expected "spy" to be called with arguments: [ â€¦(2) ]
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: Received: 
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:   1st spy call:
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:   Array [
@workflow/mcp-server:test:coverage:     "http://localhost:5000/api/v1/workflows/test-execute",
@workflow/mcp-server:test:coverage:     Object {
@workflow/mcp-server:test:coverage: -     "body": "name: test-workflow
@workflow/mcp-server:test:coverage: - tasks: []",
@workflow/mcp-server:test:coverage: +     "body": "{\"workflowYaml\":\"name: test-workflow\\ntasks: []\",\"input\":{}}",
@workflow/mcp-server:test:coverage:       "headers": Object {
@workflow/mcp-server:test:coverage: -       "Content-Type": "application/x-yaml",
@workflow/mcp-server:test:coverage: +       "Content-Type": "application/json",
@workflow/mcp-server:test:coverage:       },
@workflow/mcp-server:test:coverage:       "method": "POST",
@workflow/mcp-server:test:coverage:     },
@workflow/mcp-server:test:coverage:   ]
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: Number of calls: 1
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:    Ã— GatewayClient > validateWorkflow > should handle validation errors from API 3ms
@workflow/mcp-server:test:coverage:      â†’ expected true to be false // Object.is equality
@workflow/mcp-server:test:coverage:    Ã— GatewayClient > validateWorkflow > should handle API errors during validation 173ms
@workflow/mcp-server:test:coverage:      â†’ expected [Function] to throw error including 'Failed to validate workflow: 400 Bad â€¦' but got 'response.json is not a function'
@workflow/mcp-server:test:coverage: stderr | tests/tools/generate-workflow.test.ts > generateWorkflow tool > generateWorkflow > should fall back to template when LLM fails
@workflow/mcp-server:test:coverage: LLM generation failed, falling back to template: Error: API error
@workflow/mcp-server:test:coverage:     at t.<anonymous> (/Users/darren/dev/workflow/packages/workflow-mcp-server/tests/tools/generate-workflow.test.ts:323:55)
@workflow/mcp-server:test:coverage:     at new mockCall (file:///Users/darren/dev/workflow/node_modules/.pnpm/@vitest+spy@2.1.9/node_modules/@vitest/spy/dist/index.js:61:17)
@workflow/mcp-server:test:coverage:     at new spy (file:///Users/darren/dev/workflow/node_modules/.pnpm/tinyspy@3.0.2/node_modules/tinyspy/dist/index.js:45:34)
@workflow/mcp-server:test:coverage:     at new LlmService (/Users/darren/dev/workflow/packages/workflow-mcp-server/src/services/llm-service.ts:21:21)
@workflow/mcp-server:test:coverage:     at getLlmService (/Users/darren/dev/workflow/packages/workflow-mcp-server/src/tools/generate-workflow.ts:217:18)
@workflow/mcp-server:test:coverage:     at generateWorkflow (/Users/darren/dev/workflow/packages/workflow-mcp-server/src/tools/generate-workflow.ts:256:19)
@workflow/mcp-server:test:coverage:     at processTicksAndRejections (node:internal/process/task_queues:105:5)
@workflow/mcp-server:test:coverage:     at /Users/darren/dev/workflow/packages/workflow-mcp-server/tests/tools/generate-workflow.test.ts:334:22
@workflow/mcp-server:test:coverage:     at file:///Users/darren/dev/workflow/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:5
@workflow/mcp-server:test:coverage:     at runTest (file:///Users/darren/dev/workflow/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:11)
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  âœ“ tests/tools/generate-workflow.test.ts (22 tests) 431ms
workflow-ui:test:coverage: [90mstderr[2m | components/builder/properties-panel.test.tsx[2m > [22m[2mPropertiesPanel[2m > [22m[2mRendering[2m > [22m[2mshould show node properties when node is selected
workflow-ui:test:coverage: [22m[39mAn update to PropertiesPanel inside a test was not wrapped in act(...).
workflow-ui:test:coverage: 
workflow-ui:test:coverage: When testing, code that causes React state updates should be wrapped into act(...):
workflow-ui:test:coverage: 
workflow-ui:test:coverage: act(() => {
workflow-ui:test:coverage:   /* fire events that update state */
workflow-ui:test:coverage: });
workflow-ui:test:coverage: /* assert on the output */
workflow-ui:test:coverage: 
workflow-ui:test:coverage: This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
workflow-ui:test:coverage: An update to PropertiesPanel inside a test was not wrapped in act(...).
workflow-ui:test:coverage: 
workflow-ui:test:coverage: When testing, code that causes React state updates should be wrapped into act(...):
workflow-ui:test:coverage: 
workflow-ui:test:coverage: act(() => {
workflow-ui:test:coverage:   /* fire events that update state */
workflow-ui:test:coverage: });
workflow-ui:test:coverage: /* assert on the output */
workflow-ui:test:coverage: 
workflow-ui:test:coverage: This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
workflow-ui:test:coverage: 
workflow-ui:test:coverage: [90mstderr[2m | components/workflows/workflow-list-accessibility.test.tsx[2m > [22m[2mWorkflowList Accessibility[2m > [22m[2mshould not have accessibility violations
workflow-ui:test:coverage: [22m[39mAn update to WorkflowList inside a test was not wrapped in act(...).
workflow-ui:test:coverage: 
workflow-ui:test:coverage: When testing, code that causes React state updates should be wrapped into act(...):
workflow-ui:test:coverage: 
workflow-ui:test:coverage: act(() => {
workflow-ui:test:coverage:   /* fire events that update state */
workflow-ui:test:coverage: });
workflow-ui:test:coverage: /* assert on the output */
workflow-ui:test:coverage: 
workflow-ui:test:coverage: This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
workflow-ui:test:coverage: 
@workflow/cli:test:coverage:  âœ“ tests/workflow-generator/dependency-analyzer.test.ts (9 tests) 32ms
workflow-ui:test:coverage: [90mstderr[2m | components/builder/properties-panel.test.tsx[2m > [22m[2mPropertiesPanel[2m > [22m[2mNode Selection[2m > [22m[2mshould display first selected node when multiple nodes selected
workflow-ui:test:coverage: [22m[39mAn update to PropertiesPanel inside a test was not wrapped in act(...).
workflow-ui:test:coverage: 
workflow-ui:test:coverage: When testing, code that causes React state updates should be wrapped into act(...):
workflow-ui:test:coverage: 
workflow-ui:test:coverage: act(() => {
workflow-ui:test:coverage:   /* fire events that update state */
workflow-ui:test:coverage: });
workflow-ui:test:coverage: /* assert on the output */
workflow-ui:test:coverage: 
workflow-ui:test:coverage: This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
workflow-ui:test:coverage: An update to PropertiesPanel inside a test was not wrapped in act(...).
workflow-ui:test:coverage: 
workflow-ui:test:coverage: When testing, code that causes React state updates should be wrapped into act(...):
workflow-ui:test:coverage: 
workflow-ui:test:coverage: act(() => {
workflow-ui:test:coverage:   /* fire events that update state */
workflow-ui:test:coverage: });
workflow-ui:test:coverage: /* assert on the output */
workflow-ui:test:coverage: 
workflow-ui:test:coverage: This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
workflow-ui:test:coverage: 
@workflow/cli:test:coverage:  âœ“ tests/services/debugger.test.ts (21 tests) 93ms
@workflow/cli:test:coverage:  âœ“ tests/openapi-parser.test.ts (20 tests) 209ms
@workflow/cli:test:coverage:  âœ“ tests/services/mock-executor.test.ts (15 tests) 212ms
@workflow/cli:test:coverage:  âœ“ tests/commands/init.test.ts (18 tests) 36ms
@workflow/cli:test:coverage:  âœ“ tests/services/gateway-client.test.ts (23 tests) 233ms
@workflow/cli:test:coverage:  âœ“ tests/commands/validate.test.ts (17 tests) 135ms
@workflow/cli:test:coverage:  âœ“ tests/commands/test.test.ts (16 tests) 88ms
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: â¯â¯â¯â¯â¯â¯â¯ Failed Tests 7 â¯â¯â¯â¯â¯â¯â¯
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  FAIL  tests/services/gateway-client.test.ts > GatewayClient > validateWorkflow > should validate a workflow successfully
@workflow/mcp-consumer:test:coverage:  âœ“ src/__tests__/get-workflow-details.test.ts (7 tests) 25ms
@workflow/mcp-server:test:coverage: AssertionError: expected "spy" to be called with arguments: [ â€¦(2) ]
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: Received: 
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:   1st spy call:
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:   Array [
@workflow/mcp-server:test:coverage:     "http://localhost:5000/api/v1/workflows/test-execute",
@workflow/mcp-server:test:coverage:     Object {
@workflow/mcp-server:test:coverage: -     "body": "name: test-workflow
@workflow/mcp-server:test:coverage: - tasks: []",
@workflow/mcp-server:test:coverage: +     "body": "{\"workflowYaml\":\"name: test-workflow\\ntasks: []\",\"input\":{}}",
@workflow/mcp-server:test:coverage:       "headers": Object {
@workflow/mcp-server:test:coverage: -       "Content-Type": "application/x-yaml",
@workflow/mcp-server:test:coverage: +       "Content-Type": "application/json",
@workflow/mcp-server:test:coverage:       },
@workflow/mcp-server:test:coverage:       "method": "POST",
@workflow/mcp-server:test:coverage:     },
@workflow/mcp-server:test:coverage:   ]
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: Number of calls: 1
@workflow/mcp-server:test:coverage: 
@workflow/mcp-consumer:test:coverage:  âœ“ src/__tests__/resources.test.ts (11 tests) 35ms
@workflow/mcp-server:test:coverage:  â¯ tests/services/gateway-client.test.ts:118:25
@workflow/mcp-consumer:test:coverage:  âœ“ src/__tests__/execute-workflow.test.ts (14 tests) 104ms
workflow-ui:test:coverage: [90mstderr[2m | components/builder/properties-panel.test.tsx[2m > [22m[2mPropertiesPanel[2m > [22m[2mNode Selection[2m > [22m[2mshould show message when multiple nodes selected
workflow-ui:test:coverage: [22m[39mAn update to PropertiesPanel inside a test was not wrapped in act(...).
workflow-ui:test:coverage: 
workflow-ui:test:coverage: When testing, code that causes React state updates should be wrapped into act(...):
workflow-ui:test:coverage: 
workflow-ui:test:coverage: act(() => {
workflow-ui:test:coverage:   /* fire events that update state */
workflow-ui:test:coverage: });
workflow-ui:test:coverage: /* assert on the output */
workflow-ui:test:coverage: 
workflow-ui:test:coverage: This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
workflow-ui:test:coverage: An update to PropertiesPanel inside a test was not wrapped in act(...).
workflow-ui:test:coverage: 
workflow-ui:test:coverage: When testing, code that causes React state updates should be wrapped into act(...):
workflow-ui:test:coverage: 
workflow-ui:test:coverage: act(() => {
workflow-ui:test:coverage:   /* fire events that update state */
workflow-ui:test:coverage: });
workflow-ui:test:coverage: /* assert on the output */
workflow-ui:test:coverage: 
workflow-ui:test:coverage: This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
workflow-ui:test:coverage: 
@workflow/cli:test:coverage:  âœ“ tests/commands/explain.test.ts (20 tests) 223ms
@workflow/cli:test:coverage:  âœ“ tests/commands/run.test.ts (14 tests) 158ms
@workflow/mcp-consumer:test:coverage:  âœ“ src/__tests__/suggest-labels.test.ts (9 tests) 26ms
@workflow/mcp-consumer:test:coverage:  âœ“ src/__tests__/prompts.test.ts (15 tests) 40ms
@workflow/mcp-consumer:test:coverage:  âœ“ src/__tests__/search-workflows.test.ts (9 tests) 95ms
@workflow/cli:test:coverage:  âœ“ tests/commands/debug.test.ts (21 tests) 225ms
@workflow/mcp-consumer:test:coverage:  âœ“ src/__tests__/e2e.test.ts (11 tests) 138ms
@workflow/mcp-consumer:test:coverage:  âœ“ src/__tests__/list-tasks.test.ts (8 tests) 45ms
@workflow/mcp-consumer:test:coverage:  âœ“ src/__tests__/list-workflows.test.ts (15 tests) 220ms
@workflow/cli:test:coverage:  âœ“ tests/loaders.test.ts (18 tests) 408ms
@workflow/cli:test:coverage:  âœ“ tests/commands/tasks.test.ts (20 tests) 416ms
@workflow/cli:test:coverage:  âœ“ tests/config.test.ts (21 tests) 432ms
@workflow/mcp-consumer:test:coverage:  âœ“ src/__tests__/manage-labels.test.ts (7 tests) 94ms
@workflow/mcp-consumer:test:coverage:  âœ“ src/__tests__/list-labels.test.ts (7 tests) 288ms
@workflow/mcp-server:test:coverage:     116|       const result = await client.validateWorkflow(yaml);
@workflow/mcp-server:test:coverage:     117| 
@workflow/mcp-server:test:coverage:     118|       expect(mockFetch).toHaveBeenCalledWith('http://localhost:5000/apâ€¦
@workflow/mcp-server:test:coverage:        |                         ^
@workflow/mcp-server:test:coverage:     119|         method: 'POST',
@workflow/mcp-server:test:coverage:     120|         headers: { 'Content-Type': 'application/x-yaml' },
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/7]â¯
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  FAIL  tests/services/gateway-client.test.ts > GatewayClient > validateWorkflow > should handle validation errors from API
@workflow/mcp-server:test:coverage: AssertionError: expected true to be false // Object.is equality
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: - Expected
@workflow/mcp-server:test:coverage: + Received
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: - false
@workflow/mcp-server:test:coverage: + true
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  â¯ tests/services/gateway-client.test.ts:142:28
@workflow/mcp-server:test:coverage:     140|       const result = await client.validateWorkflow(yaml);
@workflow/mcp-server:test:coverage:     141| 
@workflow/mcp-server:test:coverage:     142|       expect(result.valid).toBe(false);
@workflow/mcp-server:test:coverage:        |                            ^
@workflow/mcp-server:test:coverage:     143|       expect(result.errors).toHaveLength(1);
@workflow/mcp-server:test:coverage:     144|     });
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/7]â¯
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  FAIL  tests/services/gateway-client.test.ts > GatewayClient > validateWorkflow > should handle API errors during validation
@workflow/mcp-server:test:coverage: AssertionError: expected [Function] to throw error including 'Failed to validate workflow: 400 Bad â€¦' but got 'response.json is not a function'
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: Expected: "Failed to validate workflow: 400 Bad Request"
@workflow/mcp-server:test:coverage: Received: "response.json is not a function"
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  â¯ tests/services/gateway-client.test.ts:153:7
@workflow/mcp-server:test:coverage:     151|       });
@workflow/mcp-server:test:coverage:     152| 
@workflow/mcp-server:test:coverage:     153|       await expect(client.validateWorkflow('invalid yaml')).rejects.toâ€¦
@workflow/mcp-server:test:coverage:        |       ^
@workflow/mcp-server:test:coverage:     154|     });
@workflow/mcp-server:test:coverage:     155|   });
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/7]â¯
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  FAIL  tests/services/refinement-service.test.ts > RefinementService > termination: max_iterations > should stop after max iterations
workflow-ui:test:coverage: [90mstderr[2m | components/builder/properties-panel.test.tsx[2m > [22m[2mPropertiesPanel[2m > [22m[2mLabel Editing[2m > [22m[2mshould render label input field
workflow-ui:test:coverage: [22m[39mAn update to PropertiesPanel inside a test was not wrapped in act(...).
workflow-ui:test:coverage: 
workflow-ui:test:coverage: When testing, code that causes React state updates should be wrapped into act(...):
workflow-ui:test:coverage: 
workflow-ui:test:coverage: act(() => {
workflow-ui:test:coverage:   /* fire events that update state */
workflow-ui:test:coverage: });
workflow-ui:test:coverage: /* assert on the output */
workflow-ui:test:coverage: 
workflow-ui:test:coverage: This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
workflow-ui:test:coverage: An update to PropertiesPanel inside a test was not wrapped in act(...).
workflow-ui:test:coverage: 
workflow-ui:test:coverage: When testing, code that causes React state updates should be wrapped into act(...):
workflow-ui:test:coverage: 
workflow-ui:test:coverage: act(() => {
workflow-ui:test:coverage:   /* fire events that update state */
workflow-ui:test:coverage: });
workflow-ui:test:coverage: /* assert on the output */
workflow-ui:test:coverage: 
workflow-ui:test:coverage: This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
workflow-ui:test:coverage: 
@workflow/mcp-server:test:coverage: AssertionError: expected 'oscillation_detected' to be 'max_iterations' // Object.is equality
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: Expected: "max_iterations"
@workflow/mcp-server:test:coverage: Received: "oscillation_detected"
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  â¯ tests/services/refinement-service.test.ts:87:40
@workflow/mcp-server:test:coverage:      85| 
@workflow/mcp-server:test:coverage:      86|       expect(result.valid).toBe(false);
@workflow/mcp-server:test:coverage:      87|       expect(result.terminationReason).toBe('max_iterations');
@workflow/mcp-server:test:coverage:        |                                        ^
@workflow/mcp-server:test:coverage:      88|       expect(result.history.length).toBeLessThanOrEqual(2);
@workflow/mcp-server:test:coverage:      89|     });
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/7]â¯
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  FAIL  tests/services/refinement-service.test.ts > RefinementService > termination: max_iterations > should respect custom max iterations
@workflow/mcp-server:test:coverage: AssertionError: expected 'no_progress' to be 'max_iterations' // Object.is equality
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: Expected: "max_iterations"
@workflow/mcp-server:test:coverage: Received: "no_progress"
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  â¯ tests/services/refinement-service.test.ts:105:40
@workflow/mcp-server:test:coverage:     103|       const result = await service.refineWorkflow('name: test', mockTaâ€¦
@workflow/mcp-server:test:coverage:     104| 
@workflow/mcp-server:test:coverage:     105|       expect(result.terminationReason).toBe('max_iterations');
@workflow/mcp-server:test:coverage:        |                                        ^
@workflow/mcp-server:test:coverage:     106|       expect(callCount).toBe(5);
@workflow/mcp-server:test:coverage:     107|     });
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/7]â¯
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  FAIL  tests/services/refinement-service.test.ts > RefinementService > termination: oscillation_detected > should detect oscillation when same errors reappear
@workflow/mcp-server:test:coverage: AssertionError: expected 'no_progress' to be 'oscillation_detected' // Object.is equality
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: Expected: "oscillation_detected"
@workflow/mcp-server:test:coverage: Received: "no_progress"
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  â¯ tests/services/refinement-service.test.ts:133:40
@workflow/mcp-server:test:coverage:     131| 
@workflow/mcp-server:test:coverage:     132|       expect(result.valid).toBe(false);
@workflow/mcp-server:test:coverage:     133|       expect(result.terminationReason).toBe('oscillation_detected');
@workflow/mcp-server:test:coverage:        |                                        ^
@workflow/mcp-server:test:coverage:     134|     });
@workflow/mcp-server:test:coverage:     135| 
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/7]â¯
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  FAIL  tests/services/refinement-service.test.ts > RefinementService > history tracking > should track each iteration in history
@workflow/mcp-server:test:coverage: AssertionError: expected [ { iteration: 1, â€¦(2) } ] to have a length of 2 but got 1
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: - Expected
@workflow/mcp-server:test:coverage: + Received
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: - 2
@workflow/mcp-server:test:coverage: + 1
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  â¯ tests/services/refinement-service.test.ts:323:30
@workflow/mcp-server:test:coverage:     321|       const result = await service.refineWorkflow('name: test', mockTaâ€¦
@workflow/mcp-server:test:coverage:     322| 
@workflow/mcp-server:test:coverage:     323|       expect(result.history).toHaveLength(2);
@workflow/mcp-server:test:coverage:        |                              ^
@workflow/mcp-server:test:coverage:     324|       expect(result.history[0].iteration).toBe(1);
@workflow/mcp-server:test:coverage:     325|       expect(result.history[1].iteration).toBe(2);
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/7]â¯
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage:  Test Files  2 failed | 9 passed (11)
@workflow/mcp-server:test:coverage:       Tests  7 failed | 133 passed (140)
@workflow/mcp-server:test:coverage:    Start at  08:23:59
@workflow/mcp-server:test:coverage:    Duration  8.00s (transform 12.07s, setup 0ms, collect 24.03s, tests 1.03s, environment 40ms, prepare 17.48s)
@workflow/mcp-server:test:coverage: 
@workflow/mcp-server:test:coverage: â€‰ELIFECYCLEâ€‰ Command failed with exit code 1.
@workflow/cli:test:coverage:  âœ“ tests/crd-generator.test.ts (24 tests) 688ms
@workflow/ui-components:build: cache miss, executing c475988baada1373
workflow-vscode-server:build: cache miss, executing 10f2cec8c9e8bc8f
workflow-vscode-client:build: cache miss, executing 26751eb2ad162195
@workflow/mcp-server:test:coverage: ERROR: command finished with error: command (/Users/darren/dev/workflow/packages/workflow-mcp-server) /usr/local/bin/pnpm run test:coverage exited (1)
workflow-ui:test:coverage: â€‰ELIFECYCLEâ€‰ Command failed.
@workflow/mcp-consumer:test:coverage: â€‰ELIFECYCLEâ€‰ Command failed.
@workflow/cli:test:coverage: â€‰ELIFECYCLEâ€‰ Command failed.
@workflow/mcp-server#test:coverage: command (/Users/darren/dev/workflow/packages/workflow-mcp-server) /usr/local/bin/pnpm run test:coverage exited (1)

 Tasks:    8 successful, 15 total
Cached:    1 cached, 15 total
  Time:    22.806s 
Failed:    @workflow/mcp-server#test:coverage

 ERROR  run failed: command  exited (1)
