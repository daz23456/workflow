apiVersion: workflow.example.com/v1
kind: Workflow
metadata:
  name: retry-fail-twice
  namespace: test
spec:
  description: "Tests orchestrator retry - endpoint fails twice then succeeds (within retry limit)"
  input:
    key:
      type: string
      description: "Unique key for this test run"
  tasks:
    - id: will-fail-twice
      taskRef: failntimes
      input:
        failCount: "2"
        key: "{{input.key}}"
  output:
    result: "{{tasks.will-fail-twice.output.message}}"
    attempts: "{{tasks.will-fail-twice.output.attempts}}"
